<!DOCTYPE html><html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Pro Document Photo & Seal Editor</title><!-- Libraries --><script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/docx/8.5.0/docx.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script><style>
body { margin:0; font-family:Arial; background:#f0f2f5; }
.container { max-width:700px; margin:auto; padding:12px; }
h2 { text-align:center; }
input,button,select { width:100%; padding:12px; margin-top:10px; border-radius:8px; border:1px solid #ccc; }
button { background:#0066ff; color:white; border:none; }
canvas { width:100%; background:white; margin-top:12px; border:1px solid #ddd; touch-action:none; }
.tools { display:flex; gap:10px; }
.tools button { flex:1; }
</style></head>
<body><div class="container">
<h2>üìÑ Pro Passport Photo & Seal Editor</h2><label>Upload Document (PDF / Image)</label> <input type="file" id="docUpload" accept="application/pdf,image/*" />

<label>Upload Passport Photo</label> <input type="file" id="photoUpload" accept="image/*" capture="environment" />

<label>Upload Seal / Signature</label> <input type="file" id="sealUpload" accept="image/*" />

<label>Export Format</label> <select id="exportFormat">

<option value="pdf">PDF</option>
<option value="png">PNG</option>
<option value="docx">Word DOCX</option>
</select><div class="tools">
<button onclick="enableDraw()">‚úç Draw Signature</button>
<button onclick="resetCanvas()">üîÑ Reset</button>
</div><button onclick="exportFile()">‚¨á Export File</button>

<canvas id="canvas"></canvas>

</div><script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let baseImage = new Image();
let photoImage = new Image();
let sealImage = new Image();

let photoPos = {x:50,y:50,w:120,h:150};
let sealPos = {x:200,y:200,w:150,h:80};
let dragging = null;
let drawMode=false;

function loadImage(file, imageObj){
 return new Promise(res=>{
   const reader=new FileReader();
   reader.onload=e=>{ imageObj.onload=res; imageObj.src=e.target.result; };
   reader.readAsDataURL(file);
 });
}

async function loadPDF(file){
 const buffer=await file.arrayBuffer();
 const pdf=await pdfjsLib.getDocument({data:buffer}).promise;
 const page=await pdf.getPage(1);
 const viewport=page.getViewport({scale:1.5});
 canvas.width=viewport.width;
 canvas.height=viewport.height;
 await page.render({canvasContext:ctx,viewport}).promise;
}

function redraw(){
 ctx.clearRect(0,0,canvas.width,canvas.height);
 if(baseImage.src) ctx.drawImage(baseImage,0,0,canvas.width,canvas.height);
 if(photoImage.src) ctx.drawImage(photoImage,photoPos.x,photoPos.y,photoPos.w,photoPos.h);
 if(sealImage.src) ctx.drawImage(sealImage,sealPos.x,sealPos.y,sealPos.w,sealPos.h);
}

// Upload Handlers

document.getElementById('docUpload').onchange=async e=>{
 const file=e.target.files[0];
 if(file.type==='application/pdf'){
   await loadPDF(file);
 }else{
   await loadImage(file,baseImage);
   canvas.width=baseImage.width;
   canvas.height=baseImage.height;
   ctx.drawImage(baseImage,0,0);
 }
};

document.getElementById('photoUpload').onchange=async e=>{
 await loadImage(e.target.files[0],photoImage);
 redraw();
};

document.getElementById('sealUpload').onchange=async e=>{
 await loadImage(e.target.files[0],sealImage);
 redraw();
};

// Drag Move
canvas.addEventListener('pointerdown',e=>{
 const x=e.offsetX, y=e.offsetY;
 if(drawMode) return;
 if(x>photoPos.x && x<photoPos.x+photoPos.w && y>photoPos.y && y<photoPos.y+photoPos.h) dragging='photo';
 else if(x>sealPos.x && x<sealPos.x+sealPos.w && y>sealPos.y && y<sealPos.y+sealPos.h) dragging='seal';
});

canvas.addEventListener('pointermove',e=>{
 if(drawMode){
   ctx.lineWidth=2;
   ctx.lineTo(e.offsetX,e.offsetY);
   ctx.stroke();
   return;
 }
 if(!dragging) return;
 if(dragging==='photo'){ photoPos.x=e.offsetX-50; photoPos.y=e.offsetY-50; }
 if(dragging==='seal'){ sealPos.x=e.offsetX-50; sealPos.y=e.offsetY-40; }
 redraw();
});

canvas.addEventListener('pointerup',()=>dragging=null);

// Draw Signature
function enableDraw(){ drawMode=true; ctx.beginPath(); }

// Reset
function resetCanvas(){
 drawMode=false;
 redraw();
}

// Export
async function exportFile(){
 const format=document.getElementById('exportFormat').value;
 const {jsPDF}=window.jspdf;

 if(format==='pdf'){
   const pdf=new jsPDF('p','pt',[canvas.width,canvas.height]);
   pdf.addImage(canvas.toDataURL(),'PNG',0,0,canvas.width,canvas.height);
   pdf.save('document.pdf');
 }

 if(format==='png'){
   const link=document.createElement('a');
   link.download='document.png';
   link.href=canvas.toDataURL();
   link.click();
 }

 if(format==='docx'){
   const doc=new docx.Document({
     sections:[{
       children:[
         new docx.Paragraph({
           children:[
             new docx.ImageRun({ data:canvas.toDataURL().split(',')[1], transformation:{ width:600, height:800 } })
           ]
         })
       ]
     }]
   });
   const blob=await docx.Packer.toBlob(doc);
   saveAs(blob,'document.docx');
 }
}
</script></body>
</html>
