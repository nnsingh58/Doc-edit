<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Pro Editor - Complete PDF Solution</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #0F172A;
            --secondary: #1E293B;
            --accent: #3B82F6;
            --accent-hover: #2563EB;
            --success: #10B981;
            --danger: #EF4444;
            --warning: #F59E0B;
            --bg: #F8FAFC;
            --surface: #FFFFFF;
            --text: #0F172A;
            --text-muted: #64748B;
            --border: #E2E8F0;
            --shadow: rgba(15, 23, 42, 0.08);
            --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        /* Header */
        header {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 20px var(--shadow);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--gradient-1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
        }
        
        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 1.5rem;
        }
        
        /* Upload Section */
        .upload-section {
            background: var(--surface);
            border-radius: 24px;
            padding: 3rem;
            text-align: center;
            border: 2px dashed var(--border);
            margin-bottom: 2rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .upload-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(59, 130, 246, 0.05) 0%, transparent 70%);
            pointer-events: none;
        }
        
        .upload-section.drag-over {
            border-color: var(--accent);
            background: rgba(59, 130, 246, 0.05);
            transform: scale(1.01);
        }
        
        .upload-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }
        
        .upload-title {
            font-size: 1.75rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }
        
        .upload-subtitle {
            color: var(--text-muted);
            margin-bottom: 2rem;
            font-size: 1.05rem;
        }
        
        .upload-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 0.875rem 2rem;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Outfit', sans-serif;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .btn-primary {
            background: var(--gradient-1);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: var(--surface);
            color: var(--primary);
            border: 2px solid var(--border);
        }
        
        .btn-secondary:hover {
            border-color: var(--accent);
            color: var(--accent);
            transform: translateY(-2px);
        }
        
        /* Tools Grid */
        .tools-section {
            margin-bottom: 2rem;
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }
        
        .tool-card {
            background: var(--surface);
            border-radius: 16px;
            padding: 1.75rem;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .tool-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-1);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        
        .tool-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px var(--shadow);
            border-color: var(--accent);
        }
        
        .tool-card:hover::before {
            transform: scaleX(1);
        }
        
        .tool-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .tool-card:nth-child(1) .tool-icon { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .tool-card:nth-child(2) .tool-icon { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .tool-card:nth-child(3) .tool-icon { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .tool-card:nth-child(4) .tool-icon { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .tool-card:nth-child(5) .tool-icon { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .tool-card:nth-child(6) .tool-icon { background: linear-gradient(135deg, #30cfd0 0%, #330867 100%); }
        .tool-card:nth-child(7) .tool-icon { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
        .tool-card:nth-child(8) .tool-icon { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); }
        
        .tool-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }
        
        .tool-description {
            color: var(--text-muted);
            font-size: 0.95rem;
        }
        
        /* Editor Canvas */
        .editor-section {
            background: var(--surface);
            border-radius: 24px;
            padding: 2rem;
            display: none;
            margin-bottom: 2rem;
        }
        
        .editor-section.active {
            display: block;
        }
        
        .editor-toolbar {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border);
        }
        
        .toolbar-group {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        .tool-btn {
            padding: 0.625rem 1.25rem;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .tool-btn:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }
        
        .tool-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }
        
        .canvas-container {
            background: #f0f0f0;
            border-radius: 16px;
            min-height: 600px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: auto;
        }
        
        #pdfCanvas {
            max-width: 100%;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(8px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--surface);
            border-radius: 24px;
            padding: 2.5rem;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary);
        }
        
        .close-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: none;
            background: var(--bg);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            transition: all 0.2s ease;
        }
        
        .close-btn:hover {
            background: var(--danger);
            color: white;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--primary);
        }
        
        .form-input,
        .form-select {
            width: 100%;
            padding: 0.875rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            font-family: 'Outfit', sans-serif;
            transition: all 0.2s ease;
        }
        
        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        /* Camera Section */
        .camera-container {
            position: relative;
            background: #000;
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 1.5rem;
        }
        
        #camera {
            width: 100%;
            display: block;
        }
        
        .camera-controls {
            position: absolute;
            bottom: 1.5rem;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 1rem;
        }
        
        .capture-btn {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background: white;
            border: 4px solid var(--accent);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .capture-btn:hover {
            transform: scale(1.1);
        }
        
        /* Loading Spinner */
        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }
        
        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Preview Image */
        .preview-container {
            margin-top: 1.5rem;
        }
        
        .preview-image {
            max-width: 100%;
            border-radius: 12px;
            box-shadow: 0 4px 20px var(--shadow);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                padding: 0 1rem;
            }
            
            .logo {
                font-size: 1.25rem;
            }
            
            .container {
                padding: 0 1rem;
            }
            
            .upload-section {
                padding: 2rem 1.5rem;
            }
            
            .upload-title {
                font-size: 1.5rem;
            }
            
            .upload-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .tools-grid {
                grid-template-columns: 1fr;
            }
            
            .editor-toolbar {
                flex-direction: column;
                gap: 0.75rem;
            }
            
            .toolbar-group {
                width: 100%;
                flex-wrap: wrap;
            }
            
            .tool-btn {
                flex: 1;
            }
            
            .modal-content {
                padding: 1.5rem;
            }
        }
        
        /* Hidden input */
        input[type="file"] {
            display: none;
        }
        
        /* Status Messages */
        .status-message {
            padding: 1rem 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            display: none;
            align-items: center;
            gap: 0.75rem;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .status-message.success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .status-message.error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .status-message.active {
            display: flex;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">üìÑ</div>
                <span>PDF Pro Editor</span>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Status Messages -->
        <div id="statusMessage" class="status-message"></div>

        <!-- Upload Section -->
        <div id="uploadSection" class="upload-section">
            <div class="upload-icon">üìÅ</div>
            <h2 class="upload-title">Upload Your PDF Document</h2>
            <p class="upload-subtitle">Drag & drop PDF files here, or click to browse</p>
            <div class="upload-buttons">
                <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                    <span>üìÇ</span> Browse Files
                </button>
                <button class="btn btn-secondary" onclick="openCamera()">
                    <span>üì∑</span> Scan Document
                </button>
            </div>
            <input type="file" id="fileInput" accept=".pdf,image/*" multiple>
        </div>

        <!-- Tools Section -->
        <div class="tools-section">
            <h3 class="section-title">
                <span>üõ†Ô∏è</span> Available Tools
            </h3>
            <div class="tools-grid">
                <div class="tool-card" onclick="openTool('image')">
                    <div class="tool-icon">üñºÔ∏è</div>
                    <h4 class="tool-title">Add Images</h4>
                    <p class="tool-description">Insert passport size photos with auto crop and background removal</p>
                </div>
                <div class="tool-card" onclick="openTool('signature')">
                    <div class="tool-icon">‚úçÔ∏è</div>
                    <h4 class="tool-title">Digital Signature</h4>
                    <p class="tool-description">Add your digital signature to documents</p>
                </div>
                <div class="tool-card" onclick="openTool('seal')">
                    <div class="tool-icon">üèõÔ∏è</div>
                    <h4 class="tool-title">Official Seal</h4>
                    <p class="tool-description">Add official seals and stamps</p>
                </div>
                <div class="tool-card" onclick="openTool('text')">
                    <div class="tool-icon">üìù</div>
                    <h4 class="tool-title">Add Text</h4>
                    <p class="tool-description">Insert and edit text anywhere in the PDF</p>
                </div>
                <div class="tool-card" onclick="openTool('merge')">
                    <div class="tool-icon">üîó</div>
                    <h4 class="tool-title">Merge PDFs</h4>
                    <p class="tool-description">Combine multiple PDF files into one</p>
                </div>
                <div class="tool-card" onclick="openTool('split')">
                    <div class="tool-icon">‚úÇÔ∏è</div>
                    <h4 class="tool-title">Split PDF</h4>
                    <p class="tool-description">Extract or split pages from PDF</p>
                </div>
                <div class="tool-card" onclick="openTool('rotate')">
                    <div class="tool-icon">üîÑ</div>
                    <h4 class="tool-title">Rotate Pages</h4>
                    <p class="tool-description">Rotate PDF pages in any direction</p>
                </div>
                <div class="tool-card" onclick="openTool('watermark')">
                    <div class="tool-icon">üíß</div>
                    <h4 class="tool-title">Watermark</h4>
                    <p class="tool-description">Add text or image watermarks</p>
                </div>
            </div>
        </div>

        <!-- Editor Section -->
        <div id="editorSection" class="editor-section">
            <div class="editor-toolbar">
                <div class="toolbar-group">
                    <button class="tool-btn" onclick="addText()">
                        <span>T</span> Add Text
                    </button>
                    <button class="tool-btn" onclick="addImage()">
                        <span>üñºÔ∏è</span> Add Image
                    </button>
                    <button class="tool-btn" onclick="addSignature()">
                        <span>‚úçÔ∏è</span> Signature
                    </button>
                </div>
                <div class="toolbar-group">
                    <button class="tool-btn" onclick="rotatePage()">
                        <span>üîÑ</span> Rotate
                    </button>
                    <button class="tool-btn" onclick="zoomIn()">
                        <span>üîç+</span> Zoom In
                    </button>
                    <button class="tool-btn" onclick="zoomOut()">
                        <span>üîç-</span> Zoom Out
                    </button>
                </div>
                <div class="toolbar-group">
                    <button class="tool-btn btn-primary" onclick="savePDF()">
                        <span>üíæ</span> Save PDF
                    </button>
                </div>
            </div>
            <div class="canvas-container">
                <canvas id="pdfCanvas"></canvas>
            </div>
        </div>
    </div>

    <!-- Camera Modal -->
    <div id="cameraModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üì∑ Scan Document</h3>
                <button class="close-btn" onclick="closeCamera()">‚úï</button>
            </div>
            <div class="camera-container">
                <video id="camera" autoplay playsinline></video>
                <div class="camera-controls">
                    <button class="capture-btn" onclick="captureImage()"></button>
                </div>
            </div>
            <canvas id="captureCanvas" style="display: none;"></canvas>
            <div id="capturedPreview" class="preview-container"></div>
        </div>
    </div>

    <!-- Image Processing Modal -->
    <div id="imageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üñºÔ∏è Add & Process Image</h3>
                <button class="close-btn" onclick="closeModal('imageModal')">‚úï</button>
            </div>
            <div class="form-group">
                <label class="form-label">Upload Image</label>
                <input type="file" id="imageUpload" accept="image/*" class="form-input" style="display: block;" onchange="previewImage(this)">
            </div>
            <div class="form-group">
                <label class="form-label">Image Size</label>
                <select id="imageSize" class="form-select">
                    <option value="passport">Passport Size (35x45mm)</option>
                    <option value="stamp">Stamp Size (25x25mm)</option>
                    <option value="custom">Custom Size</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">
                    <input type="checkbox" id="autoCrop"> Auto Crop Face
                </label>
            </div>
            <div class="form-group">
                <label class="form-label">
                    <input type="checkbox" id="removeBg"> Remove Background
                </label>
            </div>
            <div id="imagePreview" class="preview-container"></div>
            <button class="btn btn-primary" onclick="processAndAddImage()" style="width: 100%;">
                Add to PDF
            </button>
        </div>
    </div>

    <!-- Signature Modal -->
    <div id="signatureModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">‚úçÔ∏è Digital Signature</h3>
                <button class="close-btn" onclick="closeModal('signatureModal')">‚úï</button>
            </div>
            <div class="form-group">
                <label class="form-label">Draw Your Signature</label>
                <canvas id="signatureCanvas" width="500" height="200" style="border: 1px solid var(--border); border-radius: 8px; cursor: crosshair; width: 100%;"></canvas>
            </div>
            <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                <button class="btn btn-secondary" onclick="clearSignature()" style="flex: 1;">
                    Clear
                </button>
                <button class="btn btn-primary" onclick="saveSignature()" style="flex: 1;">
                    Add to PDF
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Indicator -->
    <div id="loading" class="loading">
        <div class="spinner"></div>
        <p>Processing...</p>
    </div>

    <!-- PDF.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <script>
        // Global variables
        let pdfDoc = null;
        let currentPage = 1;
        let totalPages = 0;
        let scale = 1.5;
        let canvas = document.getElementById('pdfCanvas');
        let ctx = canvas.getContext('2d');
        let cameraStream = null;
        let signaturePad = null;
        
        // PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setupDragAndDrop();
            setupFileInput();
            setupSignaturePad();
        });
        
        // Drag and drop
        function setupDragAndDrop() {
            const uploadSection = document.getElementById('uploadSection');
            
            uploadSection.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadSection.classList.add('drag-over');
            });
            
            uploadSection.addEventListener('dragleave', () => {
                uploadSection.classList.remove('drag-over');
            });
            
            uploadSection.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadSection.classList.remove('drag-over');
                const files = e.dataTransfer.files;
                handleFiles(files);
            });
        }
        
        // File input
        function setupFileInput() {
            document.getElementById('fileInput').addEventListener('change', function(e) {
                handleFiles(e.target.files);
            });
        }
        
        // Handle files
        function handleFiles(files) {
            if (files.length === 0) return;
            
            const file = files[0];
            
            if (file.type === 'application/pdf') {
                loadPDF(file);
            } else if (file.type.startsWith('image/')) {
                convertImageToPDF(file);
            } else {
                showStatus('Please upload a PDF or image file', 'error');
            }
        }
        
        // Load PDF
        async function loadPDF(file) {
            showLoading(true);
            
            try {
                const arrayBuffer = await file.arrayBuffer();
                pdfDoc = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                totalPages = pdfDoc.numPages;
                
                document.getElementById('uploadSection').style.display = 'none';
                document.getElementById('editorSection').classList.add('active');
                
                renderPage(currentPage);
                showStatus('PDF loaded successfully!', 'success');
            } catch (error) {
                showStatus('Error loading PDF: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }
        
        // Render PDF page
        async function renderPage(num) {
            try {
                const page = await pdfDoc.getPage(num);
                const viewport = page.getViewport({ scale: scale });
                
                canvas.height = viewport.height;
                canvas.width = viewport.width;
                
                const renderContext = {
                    canvasContext: ctx,
                    viewport: viewport
                };
                
                await page.render(renderContext).promise;
            } catch (error) {
                showStatus('Error rendering page: ' + error.message, 'error');
            }
        }
        
        // Convert image to PDF
        async function convertImageToPDF(file) {
            showLoading(true);
            
            try {
                const img = new Image();
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    img.onload = function() {
                        const { jsPDF } = window.jspdf;
                        const pdf = new jsPDF({
                            orientation: img.width > img.height ? 'l' : 'p',
                            unit: 'px',
                            format: [img.width, img.height]
                        });
                        
                        pdf.addImage(img, 'JPEG', 0, 0, img.width, img.height);
                        const pdfBlob = pdf.output('blob');
                        loadPDF(pdfBlob);
                    };
                    img.src = e.target.result;
                };
                
                reader.readAsDataURL(file);
            } catch (error) {
                showStatus('Error converting image: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }
        
        // Camera functions
        function openCamera() {
            document.getElementById('cameraModal').classList.add('active');
            startCamera();
        }
        
        async function startCamera() {
            try {
                cameraStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment' } 
                });
                document.getElementById('camera').srcObject = cameraStream;
            } catch (error) {
                showStatus('Camera access denied: ' + error.message, 'error');
            }
        }
        
        function captureImage() {
            const video = document.getElementById('camera');
            const captureCanvas = document.getElementById('captureCanvas');
            const captureCtx = captureCanvas.getContext('2d');
            
            captureCanvas.width = video.videoWidth;
            captureCanvas.height = video.videoHeight;
            captureCtx.drawImage(video, 0, 0);
            
            const imageData = captureCanvas.toDataURL('image/jpeg');
            
            const preview = document.getElementById('capturedPreview');
            preview.innerHTML = `
                <img src="${imageData}" class="preview-image" alt="Captured">
                <button class="btn btn-primary" onclick="processCapturedImage('${imageData}')" style="margin-top: 1rem; width: 100%;">
                    Convert to PDF
                </button>
            `;
        }
        
        function processCapturedImage(imageData) {
            fetch(imageData)
                .then(res => res.blob())
                .then(blob => {
                    const file = new File([blob], 'captured.jpg', { type: 'image/jpeg' });
                    convertImageToPDF(file);
                    closeCamera();
                });
        }
        
        function closeCamera() {
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
            }
            document.getElementById('cameraModal').classList.remove('active');
            document.getElementById('capturedPreview').innerHTML = '';
        }
        
        // Tool functions
        function openTool(tool) {
            switch(tool) {
                case 'image':
                    openModal('imageModal');
                    break;
                case 'signature':
                    openModal('signatureModal');
                    break;
                case 'seal':
                    showStatus('Seal tool will be implemented', 'success');
                    break;
                case 'text':
                    addText();
                    break;
                default:
                    showStatus(`${tool} tool will be implemented`, 'success');
            }
        }
        
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        // Image processing
        function previewImage(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('imagePreview');
                    preview.innerHTML = `<img src="${e.target.result}" class="preview-image" alt="Preview">`;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        function processAndAddImage() {
            const imageFile = document.getElementById('imageUpload').files[0];
            if (!imageFile) {
                showStatus('Please select an image', 'error');
                return;
            }
            
            const autoCrop = document.getElementById('autoCrop').checked;
            const removeBg = document.getElementById('removeBg').checked;
            
            // Simulated processing
            showLoading(true);
            setTimeout(() => {
                showStatus(`Image processed (Auto Crop: ${autoCrop}, BG Removal: ${removeBg})`, 'success');
                closeModal('imageModal');
                showLoading(false);
            }, 1500);
        }
        
        // Signature pad
        function setupSignaturePad() {
            const canvas = document.getElementById('signatureCanvas');
            const ctx = canvas.getContext('2d');
            let isDrawing = false;
            
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // Touch events
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent('mousedown', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                canvas.dispatchEvent(mouseEvent);
            });
            
            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent('mousemove', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                canvas.dispatchEvent(mouseEvent);
            });
            
            canvas.addEventListener('touchend', (e) => {
                e.preventDefault();
                const mouseEvent = new MouseEvent('mouseup', {});
                canvas.dispatchEvent(mouseEvent);
            });
            
            function startDrawing(e) {
                isDrawing = true;
                const rect = canvas.getBoundingClientRect();
                ctx.beginPath();
                ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
            }
            
            function draw(e) {
                if (!isDrawing) return;
                const rect = canvas.getBoundingClientRect();
                ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 2;
                ctx.lineCap = 'round';
                ctx.stroke();
            }
            
            function stopDrawing() {
                isDrawing = false;
            }
        }
        
        function clearSignature() {
            const canvas = document.getElementById('signatureCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
        
        function saveSignature() {
            const canvas = document.getElementById('signatureCanvas');
            const signatureData = canvas.toDataURL();
            showStatus('Signature added to PDF', 'success');
            closeModal('signatureModal');
        }
        
        // Editor functions
        function addText() {
            const text = prompt('Enter text to add:');
            if (text) {
                showStatus('Text added to PDF', 'success');
            }
        }
        
        function addImage() {
            openModal('imageModal');
        }
        
        function addSignature() {
            openModal('signatureModal');
        }
        
        function rotatePage() {
            // Rotate current page 90 degrees
            showStatus('Page rotated', 'success');
        }
        
        function zoomIn() {
            scale += 0.25;
            renderPage(currentPage);
        }
        
        function zoomOut() {
            if (scale > 0.5) {
                scale -= 0.25;
                renderPage(currentPage);
            }
        }
        
        function savePDF() {
            showLoading(true);
            setTimeout(() => {
                showStatus('PDF saved successfully!', 'success');
                showLoading(false);
            }, 1000);
        }
        
        // Utility functions
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }
        
        function showStatus(message, type) {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = `status-message ${type} active`;
            
            setTimeout(() => {
                statusEl.classList.remove('active');
            }, 3000);
        }
    </script>
</body>
</html>
